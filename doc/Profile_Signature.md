# User profile signature

This is the user profile signature standard for CIS (Change Integration Service).
It is a detached signature model which allows for multiple signatures and does not enforce how the signature is propagated or where it is verified.
These verification steps are up to CIS, RPs (Relying Parties), etc.

## Format specification

Consider the following imaginary user profile:

`user_profile.json`
```
{
  "user_id": "fake_1",
  "lastModified": "2017-03-09T21:28:51.851Z",
  "groups": ["fakedata1", "fakedata2"],
  [... more additional data ... ]
}
```

and it's detached signature:

`user_profile_signature.json`
```
{
  "user_id": "fake_1",
  "lastModified": "2017-03-09T21:28:51.851Z",
  "publicKeyFingerprint": "314b27156ada34c693800621ad7d47185c4b1804055bc54f17877ba2083eee473d9742b26103853790af9256e73033d7b5d7e5c1ae35588dc3f804059d810291",
  "signature": "bDtrc2FkO2xrYXM7ZGxma3NhZGc7bGtzYWQ7ZmsK...",
  "algorithm": "ed25519"
}
```

The signature is generated by serializing `user_profile.json` and signing the result, transforming the signature into a base64 encoded string.
This string is the `signature` attribute above and is somewhat similar to [PKCS#7](https://tools.ietf.org/html/rfc2315)/[CMS](https://tools.ietf.org/html/rfc5652).

The signature `algorithm` (and attribute) is currently expected to be [ED25519](https://ed25519.cr.yp.to/) but more algorithms may be supported.
The `publicKeyFingerprint` is the SHA512 fingerprint of the public key.

## Verification

While the verification can be done through several means, one of the expected way to verify the message authenticity is to query for the signature using an OAuth endpoint, such as `https://auth.mozilla.auth0.com/api/signature?user_id=fake_1&lastModified=2017-03-09T21:28:51.851Z`.
This will return the `user_profile_signature.json` described above. It allows anyone to verify the user profile has been emitted and signed by a CIS Provider that holds the specified public/private key pair referenced to by the `publicKeyFingerprint`.
